{% extends "base.html" %}

{% block title %}Edit PM Job{% endblock %}

{% block header_title %}Edit PM Job{% endblock %}

{% block content %}
  <section>
    <form action="/pm/edit/{{ job.id }}" method="post" class="auth-form">
      <div class="form-group">
        <label for="forklift_id">Forklift:</label>
        <select name="forklift_id" id="forklift_id" required>
          {% for f in forklifts %}
          <option value="{{ f.id }}" {% if f.id == job.forklift_id %}selected{% endif %}>
            {{ f.brand }} - {{ f.eq_no }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="date">Tanggal:</label>
        <input type="date" name="date" id="date" value="{{ job.date }}" required>
      </div>

      <div class="form-group">
        <label for="technicians">Teknisi (multi-select):</label><br>
        <select name="technicians" id="technicians" multiple size="6">
          {% for u in users %}
          <option value="{{ u.id }}" {% if u.id in selected_tech_ids %}selected{% endif %}>
            {{ u.name }}
          </option>
          {% endfor %}
        </select>
        <div style="font-size:12px;color:#666;margin-top:4px;">Tahan Ctrl/Cmd untuk memilih lebih dari satu teknisi</div>
      </div>

      <div class="form-group">
        <label for="report_no">Report No:</label>
        <input type="text" name="report_no" id="report_no" value="{{ job.report_no }}" required>
      </div>

      <div class="form-group">
        <label for="job_desc">Deskripsi:</label><br>
        <textarea name="job_desc" id="job_desc" rows="4" cols="50" required>{{ job.job_desc }}</textarea>
      </div>

      <div class="form-group">
        <label for="recommendation">Recommendation:</label><br>
        <textarea name="recommendation" id="recommendation" rows="4" cols="50">{{ job.recommendation or '' }}</textarea>
      </div>

      <div class="form-group">
        <label>Next PM:</label>
        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
          {% set has_next = 1 if job.next_pm_date else 0 %}
          <label style="display:flex;align-items:center;gap:6px;margin:0;">
            <input type="radio" name="next_pm_option" value="" {% if not has_next %}checked{% endif %}>
            None
          </label>
          <label style="display:flex;align-items:center;gap:6px;margin:0;">
            <input type="radio" name="next_pm_option" value="date" {% if has_next %}checked{% endif %}>
            Tanggal
          </label>
          <input type="date" name="next_pm_date" id="next_pm_date" value="{{ job.next_pm_date or '' }}">
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn">Save</button>
        <a href="/pm/" class="btn btn-secondary">Kembali</a>
      </div>
    </form>
  </section>
{% endblock %}